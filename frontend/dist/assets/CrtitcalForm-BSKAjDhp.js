import{j as e,d as ne,r as l,f as H,u as B,g as le,bQ as oe,cc as ce,cd as ie,ce as de,cf as me}from"./index-D_CM1r6M.js";import{l as xe}from"./logo1-Cp_MkaTU.js";import{D as U}from"./react-datepicker-DcwYWBG_.js";import{f as ue}from"./format-C6WB0tTj.js";import{F as he}from"./funnel-CGItxo1m.js";import"./floating-ui.dom-DefJBFq2.js";import"./index-DzhyyO-l.js";import"./floating-ui.react-dom-BKXo97rI.js";import"./setYear-CB6OQHaj.js";import"./isSameMonth-Dw-C10qa.js";import"./parseISO-4cjP3mE1.js";import"./endOfDay-DNsC1XQt.js";import"./createLucideIcon-lGOnjJ_s.js";const pe=({form:o,tests:f,labTechSignature:D,doctorSignature:n})=>e.jsxs("div",{id:"print-area",className:"bg-white border border-cyan-700 rounded-lg px-12 py-8 mx-auto",style:{fontFamily:"Arial, sans-serif",color:"#0e7490",width:"210mm",minHeight:"297mm",boxSizing:"border-box",pageBreakAfter:"always"},children:[e.jsx("style",{children:`
          @media print {
            body * {
              visibility: hidden !important;
            }
            #print-area, #print-area * {
              visibility: visible !important;
            }
            #print-area {
              position: absolute;
              left: 0;
              top: 0;
              width: 210mm !important;
              min-height: 260mm !important;
              margin: 0 !important;
              box-shadow: none !important;
              background: white !important;
              border: none !important;
            }
          }
        `}),e.jsxs("div",{className:"flex flex-col items-center mb-2",children:[e.jsx("img",{src:xe,alt:"Hospital Logo",style:{height:"70px",width:"70px",objectFit:"contain",marginBottom:"8px"}}),e.jsx("h2",{className:"font-bold text-2xl text-cyan-900 mb-1",style:{letterSpacing:"1px"},children:"AL-SHAHBAZ MODERN DIAGNOSTIC CENTER"}),e.jsx("div",{className:"text-cyan-700 text-sm font-semibold mb-1",children:"PHC Reg No RO-58414"})]}),e.jsx("h3",{className:"font-bold text-lg text-center text-cyan-800 mb-2",style:{letterSpacing:"1px"},children:"CRITICAL RESULT FORM"}),e.jsx("div",{className:"text-center font-semibold text-cyan-700 mb-4 underline",children:"PATIENT DATA"}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-2 mb-4 text-xs",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"Date"}),e.jsx("div",{className:"border-b border-cyan-400 py-1 min-h-[22px]",children:o.date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"MR No"}),e.jsx("div",{className:"border-b border-cyan-400 py-1 min-h-[22px]",children:o.mrNo})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"Patient Name"}),e.jsx("div",{className:"border-b border-cyan-400 py-1 min-h-[22px]",children:o.patientName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"Sample Collection Time"}),e.jsx("div",{className:"border-b border-cyan-400 py-1 min-h-[22px]",children:o.sampleCollectionTime})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"Age"}),e.jsx("div",{className:"border-b border-cyan-400 py-1 min-h-[22px]",children:o.age})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"Report Delivery Time"}),e.jsx("div",{className:"border-b border-cyan-400 py-1 min-h-[22px]",children:o.reportDeliveryTime})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"Informed To"}),e.jsx("div",{className:"border-b border-cyan-400 py-1 min-h-[22px]",children:o.informedTo})]})]}),e.jsx("div",{className:"mt-4 mb-2",children:e.jsxs("table",{className:"w-full border border-cyan-700 rounded",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-cyan-100",children:[e.jsx("th",{className:"py-2 px-3 text-cyan-900 font-semibold border-r border-cyan-400 text-left text-xs",style:{width:"50%"},children:"Test Name"}),e.jsx("th",{className:"py-2 px-3 text-cyan-900 font-semibold text-left text-xs",style:{width:"50%"},children:"Critical Value"})]})}),e.jsx("tbody",{children:f.map((g,d)=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 px-3 border-t border-cyan-200 border-r text-xs min-h-[22px]",children:g.testName}),e.jsx("td",{className:"py-2 px-3 border-t border-cyan-200 text-xs min-h-[22px]",children:g.criticalValue})]},d))})]})}),e.jsxs("div",{className:"flex flex-row gap-8 mt-8 items-end text-xs",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Lab Technician Signature:"}),e.jsx("div",{className:"border-b border-cyan-400 py-1 min-h-[22px]",children:D})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Dr. Signature:"}),e.jsx("div",{className:"border-b border-cyan-400 py-1 min-h-[22px]",children:n})]})]}),e.jsx("div",{className:"mt-6 text-center text-xs text-cyan-900 py-2 border-t border-cyan-400",children:"Note:For any query related to test results,Please contact MDC as soon as possible."})]}),ge=({onOpenModal:o})=>{const f=ne(),[D,n]=l.useState(!1),[g,d]=l.useState({startDate:new Date,endDate:null}),v=()=>{const{startDate:b,endDate:y}=g,N=p=>ue(p,"yyyy-MM-dd");b&&y?f(`/lab/critical-report-Summery/${N(b)}_${N(y)}`):b?f(`/lab/critical-report-Summery/${N(b)}`):alert("Please select at least one date."),n(!1)};return e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Critical Results Management"}),e.jsxs("div",{className:"gap-2 flex relative",children:[e.jsx("button",{onClick:o,className:"bg-gray-200 text-gray-700 hover:bg-gray-300 font-medium py-2 px-4 rounded",children:"Add New Critical Result"}),e.jsx("button",{onClick:()=>n(!0),className:"text-white font-medium py-2 px-4 rounded hover:opacity-90 transition bg-[#009689]",children:"View/Download Summary"}),D&&e.jsxs("div",{className:"absolute top-full mt-2 z-50 bg-white border border-gray-300 rounded-lg p-4 shadow-lg right-0",children:[e.jsx(U,{selectsRange:!0,startDate:g.startDate,endDate:g.endDate,onChange:b=>{const[y,N]=b;d({startDate:y,endDate:N})},isClearable:!0,inline:!0}),e.jsxs("div",{className:"flex justify-end mt-2 space-x-2",children:[e.jsx("button",{onClick:()=>n(!1),className:"px-4 py-2 text-sm text-gray-600 bg-gray-100 rounded hover:bg-gray-200",children:"Cancel"}),e.jsx("button",{onClick:v,className:"px-4 py-2 text-sm text-white bg-[#009689] rounded hover:bg-opacity-90",children:"Download"})]})]})]})]})},be=({criticalResults:o,error:f,onEdit:D,onDelete:n,onPrint:g})=>{const[d,v]=l.useState(""),[b,y]=l.useState(!1),[N,p]=l.useState("ALL"),c=s=>new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0,0),C=s=>new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59,999),T=s=>{const x=new Date;switch(s){case"TODAY":return{start:c(x),end:C(x)};case"YESTERDAY":{const u=new Date(x);return u.setDate(x.getDate()-1),{start:c(u),end:C(u)}}case"7D":{const u=new Date(x);return u.setDate(x.getDate()-6),{start:c(u),end:C(x)}}case"30D":{const u=new Date(x);return u.setDate(x.getDate()-29),{start:c(u),end:C(x)}}default:return null}},P=l.useMemo(()=>{const s=Array.isArray(o)?o:[],x=d.trim().toLowerCase(),u=T(N);return s.filter(m=>{const F=[m?.mrNo,m?.patientName,m?.contactNo,...Array.isArray(m?.tests)?m.tests.map(E=>E?.testName):[]].filter(Boolean).map(String).join(" ").toLowerCase(),S=!x||F.includes(x);if(!u)return S;const A=m?.date?new Date(m.date):null,k=A&&!isNaN(A)&&A>=u.start&&A<=u.end;return S&&k})},[o,d,N]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4 w-full",children:[e.jsx("input",{type:"text",value:d,onChange:s=>v(s.target.value),placeholder:"Search MR No, name, test...",className:"flex-1 rounded-lg border border-gray-300 px-3 py-2 focus:border-cyan-500 focus:ring-cyan-500"}),e.jsxs("div",{className:"relative shrink-0",children:[e.jsxs("button",{type:"button",onClick:()=>y(s=>!s),className:"rounded-lg border border-gray-300 px-3 py-2 text-sm hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(he,{size:16}),"Filters"]}),b&&e.jsx("div",{className:"absolute right-0 mt-2 w-44 rounded-lg border border-gray-200 bg-white shadow-lg z-50",children:[{k:"ALL",label:"All Time"},{k:"TODAY",label:"Today"},{k:"YESTERDAY",label:"Yesterday"},{k:"7D",label:"Last 7 Days"},{k:"30D",label:"Last 30 Days"}].map(s=>e.jsx("button",{onClick:()=>{p(s.k),y(!1)},className:`w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${N===s.k?"bg-cyan-50 text-cyan-700":""}`,children:s.label},s.k))})]})]}),f&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:f}),o.length===0?e.jsx("div",{className:"bg-white rounded-lg shadow p-6 text-center",children:e.jsx("p",{className:"text-gray-500",children:"No critical results found. Create your first one!"})}):e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-5 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-5 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"MR No"}),e.jsx("th",{className:"px-6 py-5 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Patient Name"}),e.jsx("th",{className:"px-6 py-5 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Contact No"}),e.jsx("th",{className:"px-6 py-5 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Tests"}),e.jsx("th",{className:"px-6 py-5 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:P.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-5 whitespace-nowrap text-sm text-gray-500",children:new Date(s.date).toLocaleDateString("en-CA")}),e.jsx("td",{className:"px-6 py-5 whitespace-nowrap text-sm font-medium text-gray-900",children:s.mrNo}),e.jsx("td",{className:"px-6 py-5 whitespace-nowrap text-sm text-gray-500",children:s.patientName}),e.jsx("td",{className:"px-6 py-5 whitespace-nowrap text-sm text-gray-500",children:s.contactNo}),e.jsx("td",{className:"px-6 py-5 text-sm text-gray-500",children:s.tests&&s.tests.length>0?e.jsxs("ul",{className:"list-disc pl-5",children:[s.tests.slice(0,2).map((x,u)=>e.jsxs("li",{children:[x.testName,": ",x.criticalValue]},u)),s.tests.length>2&&e.jsxs("li",{children:["...and ",s.tests.length-2," more"]})]}):"No tests"}),e.jsxs("td",{className:"px-6 py-5 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>g(s),className:"text-cyan-600 hover:text-cyan-900 mr-3",children:"Print"}),e.jsx("button",{onClick:()=>D(s),className:"text-primary-600 hover:text-primary-900 mr-3",children:"Edit"}),e.jsx("button",{onClick:()=>n(s._id),className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},s._id))})]})})]})},ye=({isOpen:o,onClose:f,onSubmit:D,editingResult:n})=>{const g=H(),{patient:d,loading:v,error:b}=B(t=>t.patientTest),{doctors:y,loading:N}=B(t=>t.doctor),[p,c]=l.useState({date:new Date().toISOString().split("T")[0],patientName:"",gender:"",age:"",mrNo:"",sampleCollectionTime:"",reportDeliveryTime:"",informedTo:"",contactNo:""}),[C,T]=l.useState([{testName:"",criticalValue:""}]),[P,s]=l.useState(""),[x,u]=l.useState(""),[m,F]=l.useState(!1),[S]=l.useState("051-3311342"),[A,k]=l.useState(null),[E,M]=l.useState(""),[G,O]=l.useState(!1),[Z,R]=l.useState(""),w=t=>e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("span",{children:t}),e.jsx("span",{className:"text-red-600",children:"*"})]});l.useEffect(()=>{o&&g(le())},[g,o]),l.useEffect(()=>{m?c(t=>({...t,contactNo:S})):p.contactNo===S&&c(t=>({...t,contactNo:""}))},[m,S]),l.useEffect(()=>{if(d){const t=d.DateOfBirth||d.dateOfBirth,a=d.age||(t?I(t):"")||"",r=t?new Date(t):q(a);c(h=>({...h,patientName:d.name||d.Name||"",gender:d.gender||d.Gender||"",age:a,contactNo:d.contactNo||d.ContactNo||"",sampleCollectionTime:h.sampleCollectionTime,reportDeliveryTime:h.reportDeliveryTime,informedTo:h.informedTo})),k(r||null);const i=d.contactNo||d.ContactNo||"";F(!i||i.trim()==="")}},[d]),l.useEffect(()=>{if(n){const t=n.age||"",a=n.dob?new Date(n.dob):q(t),r=n.informedTo||"",i=y.some(h=>h?.user?.user_Name===r);c({date:n.date||new Date().toISOString().split("T")[0],patientName:n.patientName||"",gender:n.gender||"",age:t,contactNo:n.contactNo||"",mrNo:n.mrNo||"",sampleCollectionTime:n.sampleCollectionTime||"",reportDeliveryTime:n.reportDeliveryTime||"",informedTo:i?r:""}),T(n.tests||[{testName:"",criticalValue:""}]),s(n.labTechSignature||""),u(n.doctorSignature||""),k(a||null),F(n.contactNo===S),M(""),r&&!i&&(O(!0),R(r))}},[n,S,y]);const I=t=>{if(!t)return"";const a=new Date,r=new Date(t);let i=a.getFullYear()-r.getFullYear(),h=a.getMonth()-r.getMonth(),j=a.getDate()-r.getDate();return j<0&&(h--,j+=new Date(a.getFullYear(),a.getMonth(),0).getDate()),h<0&&(i--,h+=12),`${i} years ${h} months ${j} days`},q=(t="")=>{const a=String(t).trim();if(a.match(/^\d+$/)){const re=parseInt(a,10);M("");const V=new Date,$=new Date(V.getFullYear()-re,V.getMonth(),V.getDate());return Number.isNaN($.getTime())?null:$}const i=a.match(/(\d+)\s*years?(?:\s*(\d*)\s*months?)?(?:\s*(\d*)\s*days?)?/i);if(!i)return M(a?'Invalid age format. Use a number (e.g., "33") or "X years Y months Z days".':""),null;M("");const h=new Date,j=Number(i[1]||0),Y=Number(i[2]||0),se=Number(i[3]||0),z=new Date(h.getFullYear()-j,h.getMonth()-Y,h.getDate()-se);return Number.isNaN(z.getTime())?null:z},Q=t=>{k(t),c(a=>({...a,age:I(t)})),M("")},W=t=>{const a=t.target.value;if(c(i=>({...i,age:a})),!a.trim()){k(null),M("");return}const r=q(a);k(r)},L=t=>{const{name:a,value:r}=t.target;c(i=>({...i,[a]:r}))},X=t=>{const a=t.target.value;a==="custom"?(O(!0),c(r=>({...r,informedTo:""}))):(O(!1),R(""),c(r=>({...r,informedTo:a})))},J=t=>{const a=t.target.value;R(a),c(r=>({...r,informedTo:a}))},K=async()=>{const t=p.mrNo?.trim();if(t)try{const a=await g(oe(t)).unwrap(),r=a?.DateOfBirth||a?.dateOfBirth,i=a?.age||(r?I(r):"")||"",h=r?new Date(r):q(i);c(j=>({...j,patientName:a?.name||a?.Name||"",gender:a?.gender||a?.Gender||"",age:i,contactNo:a?.contactNo||a?.ContactNo||"",sampleCollectionTime:j.sampleCollectionTime,reportDeliveryTime:j.reportDeliveryTime,informedTo:j.informedTo})),k(h||null),F(!(a?.contactNo||a?.ContactNo)?.trim())}catch(a){console.error("Fetch by MR No failed:",a),alert(a?.payload?.message||"Patient not found. Please check MR No.")}},_=(t,a)=>{const{name:r,value:i}=a.target;T(h=>h.map((j,Y)=>Y===t?{...j,[r]:i}:j))},ee=()=>{T(t=>[...t,{testName:"",criticalValue:""}])},te=t=>{T(a=>a.filter((r,i)=>i!==t))},ae=t=>{if(t.preventDefault(),E){alert("Please correct the age format before submitting.");return}const a={...p,dob:A?A.toISOString().split("T")[0]:"",tests:C.filter(r=>r.testName&&r.criticalValue),labTechSignature:P,doctorSignature:x};D(a),c({date:new Date().toISOString().split("T")[0],patientName:"",gender:"",age:"",mrNo:"",sampleCollectionTime:"",reportDeliveryTime:"",informedTo:"",contactNo:""}),T([{testName:"",criticalValue:""}]),s(""),u(""),k(null),F(!1),M(""),O(!1),R("")};return o?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6",role:"dialog","aria-modal":"true","aria-labelledby":"critical-modal-title",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:f}),e.jsxs("div",{className:"relative w-full max-w-3xl bg-white rounded-2xl shadow-2xl ring-1 ring-black/5 max-h-[85vh] flex flex-col overflow-hidden animate-in fade-in zoom-in-95",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-primary-600 backdrop-blur px-5 sm:px-6 py-4 flex items-center justify-between",children:[e.jsx("h3",{id:"critical-modal-title",className:"text-lg sm:text-xl font-semibold text-white",children:n?"Edit Critical Result":"Add New Critical Result"}),e.jsx("button",{onClick:f,className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-gray-100 text-gray-500 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-cyan-500","aria-label":"Close",children:e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M6 18L18 6M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),e.jsx("div",{className:"px-5 sm:px-6 py-5 overflow-y-auto",children:e.jsxs("form",{onSubmit:ae,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:w("Date")}),e.jsx("input",{type:"date",name:"date",value:p.date,onChange:L,required:!0,className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-cyan-500 focus:ring-cyan-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:w("MR No")}),e.jsxs("div",{className:"mt-1 flex gap-2",children:[e.jsx("input",{type:"text",name:"mrNo",value:p.mrNo,onChange:L,required:!0,className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-cyan-500 focus:ring-cyan-500"}),e.jsx("button",{type:"button",onClick:K,disabled:v,className:"whitespace-nowrap rounded-lg bg-primary-600 px-4 py-2 text-sm font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-cyan-500 disabled:opacity-60",children:v?"...":"Fetch"})]}),b&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:b})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:w("Patient Name")}),e.jsx("input",{type:"text",name:"patientName",value:p.patientName,onChange:L,required:!0,className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-cyan-500 focus:ring-cyan-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:w("Sample Collection Time")}),e.jsx("input",{type:"text",name:"sampleCollectionTime",value:p.sampleCollectionTime,onChange:L,placeholder:"e.g. 10:30 AM",required:!0,className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-cyan-500 focus:ring-cyan-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:w("Report Delivery Time")}),e.jsx("input",{type:"text",name:"reportDeliveryTime",value:p.reportDeliveryTime,onChange:L,placeholder:"e.g. 12:15 PM",required:!0,className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-cyan-500 focus:ring-cyan-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:w("Age")}),e.jsx("input",{type:"text",name:"age",value:p.age,onChange:W,placeholder:'e.g. 33 or "33 years 2 months 10 days"',required:!0,className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-cyan-500 focus:ring-cyan-500"}),E&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:E})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Date of Birth"}),e.jsx(U,{selected:A,onChange:Q,dateFormat:"yyyy-MM-dd",className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-cyan-500 focus:ring-cyan-500",placeholderText:"Select DOB",maxDate:new Date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:w("Contact No")}),e.jsxs("div",{className:"mt-1 flex flex-col gap-2",children:[e.jsx("input",{type:"text",name:"contactNo",value:p.contactNo,onChange:L,placeholder:"e.g. 0300 0000000",required:!0,disabled:m,className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-cyan-500 focus:ring-cyan-500 disabled:bg-gray-100"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:t=>F(t.target.checked),className:"h-4 w-4 text-cyan-600 focus:ring-cyan-500 border-gray-300 rounded"}),"Use default contact (",S,")"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:w("Informed To")}),G?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:Z,onChange:J,placeholder:"Enter doctor name",required:!0,className:"flex-1 rounded-lg border border-gray-300 px-3 py-2 focus:border-cyan-500 focus:ring-cyan-500"}),e.jsx("button",{type:"button",onClick:()=>{O(!1),R(""),c(t=>({...t,informedTo:""}))},className:"rounded-lg border border-gray-300 px-3 py-2 text-sm hover:bg-gray-50",children:"Cancel"})]}):e.jsxs("select",{name:"informedTo",value:p.informedTo,onChange:X,required:!0,className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-cyan-500 focus:ring-cyan-500",children:[e.jsx("option",{value:"",children:"Select Doctor"}),N?e.jsx("option",{value:"",disabled:!0,children:"Loading doctors..."}):y?.map(t=>e.jsxs("option",{value:t?.user?.user_Name,children:[t?.user?.user_Name," - ",t?.doctor_Department]},t._id)),e.jsx("option",{value:"custom",children:"+ Add Custom Doctor"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:w("Tests")}),e.jsx("button",{type:"button",onClick:ee,className:"text-sm font-medium text-cyan-700 hover:text-cyan-900",children:"+ Add Test"})]}),e.jsx("div",{className:"space-y-2",children:C.map((t,a)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("input",{type:"text",name:"testName",value:t.testName,onChange:r=>_(a,r),placeholder:"Test Name",required:!0,className:"flex-1 rounded-lg border border-gray-300 px-3 py-2 focus:border-cyan-500 focus:ring-cyan-500"}),e.jsx("input",{type:"text",name:"criticalValue",value:t.criticalValue,onChange:r=>_(a,r),placeholder:"Critical Value",required:!0,className:"flex-1 rounded-lg border border-gray-300 px-3 py-2 focus:border-cyan-500 focus:ring-cyan-500"}),C.length>1&&e.jsx("button",{type:"button",onClick:()=>te(a),className:"h-10 w-10 rounded-lg text-red-600 hover:bg-red-50","aria-label":"Remove test row",children:"Ã—"})]},a))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:w("Lab Technician Signature")}),e.jsx("input",{type:"text",value:P,onChange:t=>s(t.target.value),required:!0,className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-cyan-500 focus:ring-cyan-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:w("Doctor Signature")}),e.jsx("input",{type:"text",value:x,onChange:t=>u(t.target.value),required:!0,className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-cyan-500 focus:ring-cyan-500"})]})]}),e.jsxs("div",{className:"sticky bottom-0 -mx-5 sm:-mx-6 px-5 sm:px-6 py-4 bg-white/90 backdrop-blur border-t border-gray-300 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:f,className:"rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-cyan-500",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:v||!!E,className:"rounded-lg bg-primary-600 px-4 py-2 text-sm font-semibold text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:opacity-60",children:v?"Saving...":n?"Update":"Save"})]})]})})]})]}):null},Pe=()=>{const o=H(),{criticalResults:f=[],loading:D,error:n,success:g}=B(m=>m.criticalResult),[d,v]=l.useState(!1),[b,y]=l.useState(null),[N,p]=l.useState(!1),[c,C]=l.useState(null);l.useEffect(()=>{o(ce())},[o]),l.useEffect(()=>{g&&!D&&(v(!1),y(null))},[g,D]);const T=(m=null)=>{y(m),v(!0)},P=()=>{v(!1),y(null)},s=m=>{o(b?de({id:b._id,data:m}):me(m))},x=m=>{window.confirm("Are you sure you want to delete this critical result?")&&o(ie(m))},u=m=>{C(m),p(!0),setTimeout(()=>{window.print(),p(!1)},500)};return e.jsx("div",{className:"p-6 bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"mx-auto bg-white p-6 rounded-md shadow-md",children:[e.jsx(ge,{onOpenModal:()=>T()}),e.jsx(be,{criticalResults:f,error:n,onEdit:T,onDelete:x,onPrint:u}),e.jsx(ye,{isOpen:d,onClose:P,onSubmit:s,editingResult:b}),N&&c&&e.jsx("div",{className:"fixed inset-0 z-50 bg-white p-8",children:e.jsx(pe,{form:c,tests:c.tests,labTechSignature:c.labTechSignature,doctorSignature:c.doctorSignature})})]})})};export{Pe as default};
