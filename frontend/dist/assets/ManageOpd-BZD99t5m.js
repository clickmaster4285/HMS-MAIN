import{r as n,j as e,f as V,d as B,u as g,a2 as z,a3 as W,a4 as q,a5 as U,X,a6 as Y,a7 as v,h as H,a8 as J,a9 as K,aa as Q}from"./index-D_CM1r6M.js";import{i as Z,j as C,k as ee,l as te,m as se,n as ae,o as re}from"./index-CVhLpNpZ.js";import{d as ie}from"./index-C4dsM683.js";import{D as ne,P as le}from"./DeletePatientConfirmation-C-n4Xl_C.js";import{h as oe}from"./printUtils-U4E80oRQ.js";import{g as de}from"./getRoleRoute-Do-Qfut4.js";import"./iconBase-DSUUJbys.js";import"./index-jLjFIv2f.js";import"./server.browser-DuO4EFVg.js";import"./logo1-Cp_MkaTU.js";const ce=({patient:s,onClose:o})=>{const[a,l]=n.useState("thermal"),[c,h]=n.useState(!1),j=async()=>{if(!a){alert("Please select a print option");return}h(!0);try{const r={patient_MRNo:s.patient_MRNo,patient_Name:s.patient_Name,patient_ContactNo:s.patient_ContactNo,patient_Guardian:s.patient_Guardian||{},patient_CNIC:s.patient_CNIC,patient_Gender:s.patient_Gender,patient_Age:s.patient_Age,patient_DateOfBirth:s.patient_DateOfBirth,patient_Address:s.patient_Address,patient_BloodType:s.patient_BloodType,patient_MaritalStatus:s.patient_MaritalStatus,visitData:s.visits&&s.visits.length>0?s.visits[s.visits.length-1]:{token:"",purpose:"Consultation",doctor:s.doctor||{}},printOption:a};oe(r,a),o()}catch(r){console.error("Printing error:",r),alert("Failed to print: "+r.message)}finally{h(!1)}},f=[{value:"thermal",label:"Thermal Slip",icon:C,description:"Small receipt-style print for quick slips"},{value:"a4",label:"A4 Form",icon:ee,description:"Standard A4 size detailed form"},{value:"pdf",label:"PDF Document",icon:te,description:"Download as PDF file"}];return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/15 backdrop-blur-lg z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4",children:[e.jsxs("div",{className:"bg-primary-600 text-white p-4 rounded-t-lg flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Print Options"}),e.jsx("button",{onClick:o,className:"text-white hover:text-gray-200 text-2xl font-thin focus:outline-none","aria-label":"Close",disabled:c,children:e.jsx(Z,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("p",{className:"text-gray-700 mb-2",children:["Patient: ",e.jsx("span",{className:"font-semibold",children:s.patient_Name})]}),e.jsxs("p",{className:"text-gray-700",children:["MR#: ",e.jsx("span",{className:"font-semibold",children:s.patient_MRNo})]}),s.visits&&s.visits.length>0&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-md",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Last Visit: ",new Date(s.visits[s.visits.length-1].visitDate||Date.now()).toLocaleDateString()]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Token: ",s.visits[s.visits.length-1].token||"N/A"]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Select Print Format"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:f.map(r=>e.jsxs("div",{className:`relative rounded-lg border-2 p-4 cursor-pointer transition-all duration-200 ${a===r.value?"border-primary-500 bg-primary-50 ring-2 ring-primary-200":"border-gray-200 bg-white hover:border-gray-300"}`,onClick:()=>l(r.value),children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`shrink-0 h-5 w-5 rounded-full border-2 flex items-center justify-center mr-3 mt-0.5 ${a===r.value?"border-primary-500 bg-primary-500":"border-gray-300"}`,children:a===r.value&&e.jsx("div",{className:"h-2 w-2 rounded-full bg-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(r.icon,{className:`h-6 w-6 ${a===r.value?"text-primary-600":"text-gray-400"}`}),e.jsx("span",{className:"ml-2 font-medium text-gray-900",children:r.label})]}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:r.description})]})]}),e.jsx("input",{type:"radio",name:"printOption",value:r.value,checked:a===r.value,onChange:()=>l(r.value),className:"absolute opacity-0 h-0 w-0"})]},r.value))})]})]}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end space-x-3",children:[e.jsx("button",{onClick:o,className:"px-5 py-2.5 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors disabled:opacity-50 font-medium",disabled:c,children:"Cancel"}),e.jsx("button",{onClick:j,className:"px-5 py-2.5 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors flex items-center disabled:opacity-50 font-medium",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Printing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2 h-5 w-5"}),"Print"]})})]})]})})};function me({title:s,titleId:o,...a},l){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":o},a),s?n.createElement("title",{id:o},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))}const xe=n.forwardRef(me);function pe({title:s,titleId:o,...a},l){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":o},a),s?n.createElement("title",{id:o},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"}))}const he=n.forwardRef(pe),ue=({currentPage:s,totalPages:o,totalItems:a,itemsPerPage:l,onPageChange:c,className:h=""})=>{if(o<=1)return null;const f=(s-1)*l+1,r=Math.min(s*l,a),w=()=>{const m=[];let p=Math.max(1,s-Math.floor(2.5)),u=Math.min(o,p+5-1);u-p+1<5&&(p=Math.max(1,u-5+1));for(let y=p;y<=u;y++)m.push(y);return m};return e.jsxs("div",{className:`flex items-center justify-between px-4 py-3 bg-white border-t border-gray-200 sm:px-6 ${h}`,children:[e.jsxs("div",{className:"flex flex-1 justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>c(s-1),disabled:s===1,className:"relative inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>c(s+1),disabled:s===o,className:"relative inline-flex items-center px-4 py-2 ml-3 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:f})," to"," ",e.jsx("span",{className:"font-medium",children:r})," of"," ",e.jsx("span",{className:"font-medium",children:a})," results"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination",children:[e.jsxs("button",{onClick:()=>c(s-1),disabled:s===1,className:"relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"sr-only",children:"Previous"}),e.jsx(xe,{className:"h-5 w-5","aria-hidden":"true"})]}),w().map(m=>e.jsx("button",{onClick:()=>c(m),className:`relative inline-flex items-center px-4 py-2 text-sm font-semibold ${s===m?"z-10 bg-primary-600 text-white focus-visible:outline focus-visible:outline-offset-2 focus-visible:outline-primary-600":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:outline-offset-0"}`,children:m},m)),e.jsxs("button",{onClick:()=>c(s+1),disabled:s===o,className:"relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"sr-only",children:"Next"}),e.jsx(he,{className:"h-5 w-5","aria-hidden":"true"})]})]})})]})]})},Ce=()=>{const s=V(),o=B(),a=g(z),l=g(W);g(q);const c=g(U),h=g(X),j=g(Y),[f,r]=n.useState(!1),[w,m]=n.useState(null),[p,u]=n.useState(null),[y,S]=n.useState(!1),[b,P]=n.useState(l.search||""),[i,N]=n.useState(()=>{const t=new Date().toISOString().split("T")[0];return{start:t,end:t}});n.useEffect(()=>{!l.fromDate&&!l.toDate&&s(v({fromDate:i.start,toDate:i.end}))},[]),n.useEffect(()=>{if(i.start&&i.end){const t=setTimeout(()=>{s(v({fromDate:i.start,toDate:i.end}))},500);return()=>clearTimeout(t)}},[i,s]),n.useEffect(()=>{const t=setTimeout(()=>{b!==l.search&&s(v({search:b,fromDate:i.start,toDate:i.end}))},500);return()=>clearTimeout(t)},[b,i,s,l.search]),n.useEffect(()=>{(async()=>await s(H({page:a.currentPage,limit:a.limit,search:l.search,filters:{fromDate:l.fromDate,toDate:l.toDate}})))()},[s,a.currentPage,l]);const O=t=>{s(Q(t))},A=async t=>{await s(K(t)),r(!0)},T=()=>{r(!1),s(J())},R=t=>{u(t),S(!0)},F=()=>{S(!1),u(null)},_=(t,d)=>{N(D=>{const x={...D,[t]:d};if(x.start&&x.end){const $=new Date(x.start),G=new Date(x.end);if($>G)return{start:x.end,end:x.start}}return x})},M=()=>{P("");const t=new Date().toISOString().split("T")[0];N({start:t,end:t}),s(v({search:"",fromDate:t,toDate:t}))},E=t=>t?t[0].toUpperCase()+t.slice(1):"",I=t=>t?.visits?.[0]||null,L=t=>{const d=t?.doctor?.user;return d?.firstName||d?.lastName?[d?.firstName,d?.lastName].filter(Boolean).join(" "):null},k=c||[];return e.jsxs("div",{className:"",children:[w&&e.jsx(ne,{patient:w,onClose:()=>m(null)}),f&&e.jsx(le,{patient:h,loading:j==="loading",onClose:T}),y&&p&&e.jsx(ce,{patient:p,onClose:F}),e.jsxs("div",{className:"max-w-8xl mx-auto bg-white rounded-xl shadow-md overflow-hidden",children:[e.jsx("div",{className:"bg-primary-600 p-4 md:p-6 text-white",children:e.jsxs("div",{className:"flex flex-col xl:flex-row justify-between items-start space-y-4 xl:space-y-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-14 w-1 bg-primary-300 mr-4 rounded-full"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"OPD Management"}),e.jsx("p",{className:"text-primary-100 mt-1",children:"View and manage outpatient department records"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-64",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ie,{className:"text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Search by name or MR#",value:b,onChange:t=>P(t.target.value)})]}),e.jsxs("div",{className:"flex flex-row gap-2 items-center",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",className:"block w-full pl-3 pr-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-primary-500",value:i.start,onChange:t=>_("start",t.target.value),placeholder:"Start date",max:i.end}),e.jsx("input",{type:"date",className:"block w-full pl-3 pr-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-primary-500",value:i.end,onChange:t=>_("end",t.target.value),placeholder:"End date",min:i.start})]}),e.jsxs("div",{className:"grid items-center grid-cols-2 gap-1",children:[e.jsx("button",{onClick:()=>{const t=new Date().toISOString().split("T")[0];N({start:t,end:t})},className:"text-xs text-primary-900 px-2 py-0.5 bg-primary-100 rounded hover:bg-primary-200",children:"Today"}),e.jsx("button",{onClick:()=>{const t=new Date,d=new Date(t);d.setDate(t.getDate()-t.getDay()),N({start:d.toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]})},className:"text-xs px-2 text-primary-900 py-0.5 bg-primary-100 rounded hover:bg-primary-200",children:"This Week"}),e.jsx("button",{onClick:()=>{const t=new Date;N({start:new Date(t.getFullYear(),t.getMonth(),1).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]})},className:"col-span-2 text-xs px-2 text-primary-900 py-0.5 bg-primary-100 rounded hover:bg-primary-200",children:"This Month"})]}),e.jsx("button",{onClick:M,className:"text-xs px-2 py-0.5 bg-red-100 text-red-700 rounded hover:bg-red-200",children:"Reset All"})]})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Token"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"MR#"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Age/Gender"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Guardian"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"CNIC"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Doctor"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:k.length>0?k.map(t=>{const d=I(t);L(d);const D=E(t.patient_Gender),x=t.patient_Gender==="male"?"bg-primary-100 text-primary-600":t.patient_Gender==="female"?"bg-pink-100 text-pink-600":"bg-gray-100 text-gray-600";return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-primary-100 text-primary-800",children:d?.token??"N/A"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.patient_MRNo}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-base font-normal text-gray-900",children:t.patient_Name})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:t.patient_Age??"â€”"}),e.jsx("div",{className:`text-sm px-4 rounded-full inline-block mt-1 ${x}`,children:D||"Other"})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.patient_ContactNo||"N/A"}),e.jsxs("div",{className:"text-sm text-gray-500 truncate max-w-xs",children:[(t.patient_Address||"No address").substring(0,20),"..."]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:t.patient_Guardian?.guardian_Name||"N/A"}),e.jsx("div",{className:"text-xs text-gray-500",children:t.patient_Guardian?.guardian_Relation||""})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.patient_CNIC||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:d?.doctor?.user?.user_Name||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:d?.doctor?.doctor_Department||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>A(t._id),className:"text-primary-600 border border-primary-200 hover:text-primary-900 p-1 rounded-md hover:bg-primary-50","aria-label":`View ${t.patient_Name}`,children:e.jsx(se,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>o(de(`/opd/edit/${t.patient_MRNo}`)),className:"text-yellow-600 border border-yellow-200 hover:text-yellow-900 p-1 rounded-md hover:bg-yellow-50","aria-label":`Edit ${t.patient_Name}`,children:e.jsx(ae,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>R(t),className:"text-primary-600 border border-primary-200 hover:text-primary-900 p-1 rounded-md hover:bg-primary-50","aria-label":`Print ${t.patient_Name}`,children:e.jsx(C,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>m(t),className:"text-red-600 border border-red-200 hover:text-red-900 p-1 rounded-md hover:bg-red-50","aria-label":`Delete ${t.patient_Name}`,children:e.jsx(re,{className:"h-5 w-5"})})]})})]},t._id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"px-6 py-4 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx("svg",{className:"w-16 h-16 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"mt-2 font-medium text-gray-600",children:"No patients found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Try adjusting your search or date filter"})]})})})})]})}),k.length>0&&a.totalPages>1&&e.jsx(ue,{currentPage:a.currentPage,totalPages:a.totalPages,totalItems:a.totalPatients,itemsPerPage:a.limit,onPageChange:O}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between justify-center sm:items-start gap-2 px-6 py-3 bg-gray-50 border-t border-gray-200",children:[i.start&&i.end&&e.jsxs("div",{className:"text-sm px-3 py-1.5 rounded-md bg-primary-600 text-white",children:["Showing patients between ",e.jsx("span",{className:"font-medium",children:new Date(i.start).toLocaleDateString()})," and ",e.jsx("span",{className:"font-medium",children:new Date(i.end).toLocaleDateString()})]}),(i.start||i.end||b)&&e.jsx("button",{onClick:M,className:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:"Reset All Filters"})]})]})]})};export{Ce as default};
