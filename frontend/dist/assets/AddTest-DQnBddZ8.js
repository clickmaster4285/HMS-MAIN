import{f as Q,d as Y,T as ee,u as A,bW as te,bX as se,bY as re,bZ as ae,r as g,b_ as ne,y as k,b$ as ie,c0 as le,j as e}from"./index-D_CM1r6M.js";import{ad as oe,ae as ce,r as de}from"./index-jLjFIv2f.js";import{I as T,R as me}from"./FormFields-cbkv4QEu.js";import{F as G,a as ue}from"./FormSection-CqnVxHJP.js";import{B}from"./Buttons-B9m6-61d.js";import"./iconBase-DSUUJbys.js";import"./index-CVhLpNpZ.js";import"./index-DK6bWzrh.js";import"./index-Dskypj5f.js";const pe=[{id:"all",label:"All"},{id:"male",label:"Male"},{id:"female",label:"Female"},{id:"child",label:"Child"},{id:"pregnant",label:"Pregnant"},{id:"nonPregnant",label:"Non-Pregnant"},{id:"adult",label:"Adult"},{id:"elderly",label:"Elderly"},{id:"newborn",label:"Newborn"},{id:"Diabetic",label:"Diabetic"},{id:"Non-Diabetic",label:"Non-Diabetic"}],ge=["mg/dL","g/dL","mmol/L","mIU/L","IU/L","IU/mL","U/L","u/mL","%","x10^2/ul","pg/mL","Pg","ng/mL","mEq/L","cells/mcL","mL/min","mg/L","mm/hr","g/L","µIU/mL","μg/dL","μmol/L","mU/L","fL","pH","min sec","sec","ml","other"],V=[{label:"Hours",options:["45 minutes","1 hour","24 hours","48 hours","72 hours"]},{label:"Days",options:["1 day","2 days","3 days","5 days","7 days"]},{label:"",options:["Other"]}],be=[{value:"text",label:"Text Input"},{value:"number",label:"Number Input"},{value:"dropdown",label:"Dropdown"}],R={colour:["Yellow","Amber","Brown","Red","Orange","Green","Blue","Colorless","Dark Yellow","Pale Yellow"],appearance:["Clear","Hazy","Cloudy","Turbid","Slightly Cloudy"],crystals:["None","Calcium Oxalate","Uric Acid","Triple Phosphate","Amorphous Urates","Amorphous Phosphates"],bacteria:["None","Few","Moderate","Many","Heavy"],testResults:["Negative","Trace","1+","2+","3+","4+"],simpleResults:["Negative","Positive"],turbidity:["Clear","Slightly Hazy","Hazy","Cloudy","Turbid"]},q=s=>{const t=s?.toLowerCase();return t.includes("colour")||t.includes("color")?R.colour:t.includes("appearance")?R.appearance:t.includes("crystal")?R.crystals:t.includes("bacteria")?R.bacteria:t.includes("turbidity")?R.turbidity:t.includes("nitrate")?R.simpleResults:t.includes("bilirubin")||t.includes("ketone")||t.includes("glucose")||t.includes("blood")||t.includes("albumin")?R.testResults:[]},he=s=>q(s).length>0,M=s=>he(s)?"dropdown":"text",_=()=>({min:"",max:"",unit:""}),$=()=>({name:"",unit:"",inputType:"text",options:[],ranges:{male:_(),female:_()}}),xe=()=>({testName:"",testDept:"",testCode:"",testPrice:"",requiresFasting:!1,reportDeliveryTime:""}),ye=(s="create")=>{const t=Q(),m=Y(),{id:i}=ee(),r=A(te),p=A(se),b=A(re),n=A(ae),[h,d]=g.useState(xe()),[x,j]=g.useState([$()]),[U,P]=g.useState(!1),[I,S]=g.useState({}),[f,L]=g.useState(""),[D,F]=g.useState(""),[C,E]=g.useState({});g.useEffect(()=>{i&&s==="edit"&&t(ne(i))},[i,t,s]),g.useEffect(()=>{r&&i&&(d({testName:r.testName||"",testDept:r.testDept||"",testCode:r.testCode||"",testPrice:r.testPrice||"",requiresFasting:r.requiresFasting||!1,reportDeliveryTime:r.reportDeliveryTime||""}),j(Array.isArray(r.fields)&&r.fields.length>0?r.fields.map(a=>{const l={},o=a.normalRange instanceof Map?Object.fromEntries(a.normalRange):a.normalRange||{};return Object.entries(o).forEach(([u,c])=>{l[u]={min:c?.min||"",max:c?.max||"",unit:c?.unit||a.unit||""}}),{name:a.name||"",unit:a.unit||"",inputType:a.inputType||M(a.name),options:a.options||q(a.name),ranges:l}}):[$()]),r.reportDeliveryTime&&(V.some(l=>l.options.includes(r.reportDeliveryTime))?(L(r.reportDeliveryTime),F("")):(L("Other"),F(r.reportDeliveryTime))))},[r,i]);const N=g.useCallback((a=h,l=x)=>{const o={};return a.testName||(o.testName="Test Name is required"),a.testCode||(o.testCode="Test Code is required"),(!a.testPrice||isNaN(a.testPrice)||Number(a.testPrice)<0)&&(o.testPrice="Valid Test Price is required"),(f==="Other"?D:f)||(o.reportDeliveryTime="Report Delivery Time is required"),l.forEach((c,y)=>{c.name||(o[`field-name-${y}`]="Field name required"),c.inputType==="dropdown"&&c.options.length===0&&(o[`field-options-${y}`]="Dropdown fields require options")}),o},[h,x,f,D]);g.useEffect(()=>{S(N())},[N]);const w=g.useCallback(a=>{const{name:l,value:o,type:u,checked:c}=a.target;d(y=>({...y,[l]:u==="checkbox"?c:o})),E(y=>({...y,[l]:!0}))},[]),O=g.useCallback((a,l,o,u,c)=>{j(y=>y.map((v,J)=>J!==a?v:l==="name"?{...v,name:o,inputType:M(o),options:q(o)}:l==="unit"||l==="inputType"?{...v,[l]:o}:l==="options"?{...v,options:Array.isArray(o)?o:o.split(",").map(H=>H.trim())}:l==="ranges"?{...v,ranges:{...v.ranges,[u]:{...v.ranges[u],[c]:o}}}:v))},[]),z=g.useCallback((a,l)=>{j(o=>o.map((u,c)=>c!==a?u:{...u,ranges:{...u.ranges,[l]:_()}}))},[]),K=g.useCallback((a,l)=>{j(o=>o.map((u,c)=>{if(c!==a)return u;const y={...u.ranges};return delete y[l],{...u,ranges:y}}))},[]),W=g.useCallback(()=>j(a=>[...a,$()]),[]),X=g.useCallback(a=>j(l=>l.length>1?l.filter((o,u)=>u!==a):l),[]),Z=g.useCallback(a=>{const l=a.target.value;L(l),l!=="Other"&&(F(""),d(o=>({...o,reportDeliveryTime:l})))},[]);return{formData:h,fields:x,errors:I,selectedReportTime:f,customReportTime:D,isSubmitting:U,touched:C,handleChange:w,handleFieldChange:O,handleReportTimeChange:Z,handleSave:async a=>{a.preventDefault();const l=N();if(S(l),Object.keys(l).length>0){k.error("Please fix form errors");return}P(!0);const o=f==="Other"?D:f,u={...h,testPrice:Number(h.testPrice),reportDeliveryTime:o,fields:x.map(c=>({name:c.name,unit:c.unit,inputType:c.inputType,options:c.inputType==="dropdown"?c.options:void 0,normalRange:Object.fromEntries(Object.entries(c.ranges).map(([y,v])=>[y,{min:v.min||"Nil",max:v.max||"Nil",unit:v.unit||c.unit||void 0}]))}))};try{i?(await t(ie({id:i,payload:u})),k.success("Test updated successfully!"),m("../all-tests")):(await t(le(u)),k.success("Test created successfully!"),m("../all-tests"))}catch(c){k.error(c.message||"An error occurred")}finally{P(!1)}},addField:W,removeField:X,addRangeType:z,removeRangeType:K,setCustomReportTime:F,getByIdLoading:p,updateLoading:b,updateError:n,mode:s,id:i}},ve=({field:s,fieldIdx:t,errors:m,onFieldChange:i,onAddRangeType:r,onRemoveRangeType:p,onRemoveField:b,rangeTypes:n})=>{const h=d=>{if(i(t,"inputType",d),d==="dropdown"){const x=q(s.name);x.length>0&&i(t,"options",x)}};return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"font-medium",children:["Field #",t+1]}),e.jsx("button",{type:"button",className:"text-red-500 hover:text-red-700 p-1",onClick:()=>b(t),children:"×"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:[e.jsx(T,{label:"Field Name",value:s.name,onChange:d=>i(t,"name",d.target.value),error:m[`field-name-${t}`],required:!0}),e.jsx(T,{label:"Input Type",type:"select",value:s.inputType,onChange:d=>h(d.target.value),options:be.map(d=>({value:d.value,label:d.label}))}),e.jsx(T,{label:"Unit",type:"select",value:s.unit,onChange:d=>i(t,"unit",d.target.value),options:ge})]}),s.inputType==="dropdown"&&e.jsxs("div",{className:"mb-6",children:[e.jsx(T,{label:"Dropdown Options (comma separated)",value:s.options?.join(", ")||"",onChange:d=>i(t,"options",d.target.value),error:m[`field-options-${t}`],placeholder:"Option 1, Option 2, Option 3",helperText:"Enter options separated by commas"}),s.options&&s.options.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Preview: "}),s.options.map((d,x)=>e.jsx("span",{className:"inline-block bg-primary-100 text-primary-800 text-xs px-2 py-1 rounded mr-1",children:d},x))]})]}),e.jsx(Te,{field:s,fieldIdx:t,errors:m,onAddRangeType:r,onRemoveRangeType:p,onFieldChange:i,rangeTypes:n})]})},Te=({field:s,fieldIdx:t,errors:m,onAddRangeType:i,onRemoveRangeType:r,onFieldChange:p,rangeTypes:b})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-medium",children:"Reference Ranges"}),e.jsxs("select",{className:"border border-gray-300 rounded p-2",onChange:n=>{n.target.value&&!s.ranges[n.target.value]&&i(t,n.target.value),n.target.value=""},children:[e.jsx("option",{value:"",children:"Add Range Type"}),b.map(n=>!s.ranges[n.id]&&e.jsx("option",{value:n.id,children:n.label},n.id))]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(s.ranges).map(([n,h])=>{const d=b.find(x=>x.id===n)||{label:n};return e.jsx(je,{type:n,range:h,rangeConfig:d,fieldIdx:t,errors:m,onRemoveRangeType:r,onFieldChange:p},n)})})]}),je=({type:s,range:t,rangeConfig:m,fieldIdx:i,errors:r,onRemoveRangeType:p,onFieldChange:b})=>e.jsxs("div",{className:"border border-gray-200 rounded p-4 relative",children:[e.jsx("button",{type:"button",className:"absolute top-2 right-2 text-gray-400 hover:text-red-500",onClick:()=>p(i,s),children:"×"}),e.jsx("h5",{className:"font-medium mb-3",children:m.label}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(T,{label:"Min Value",type:"text",value:t.min,onChange:n=>b(i,"ranges",n.target.value,s,"min"),error:r[`field-${i}-${s}-min`]}),e.jsx(T,{label:"Max Value",type:"text",value:t.max,onChange:n=>b(i,"ranges",n.target.value,s,"max"),error:r[`field-${i}-${s}-max`]})]})]}),fe=({selectedReportTime:s,customReportTime:t,error:m,onChange:i,onCustomChange:r})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Report Delivery Time *"}),e.jsxs("select",{className:`block w-full border ${m?"border-red-500":"border-gray-300"} rounded-md p-2`,value:s,onChange:i,children:[e.jsx("option",{value:"",children:"Select time"}),V.map((p,b)=>e.jsx("optgroup",{label:p.label,children:p.options.map(n=>e.jsx("option",{value:n,children:n},n))},b))]}),s==="Other"&&e.jsx("input",{type:"text",className:"block w-full border border-gray-300 rounded-md p-2 mt-2",value:t,onChange:p=>r(p.target.value),placeholder:"Enter custom time"}),m&&e.jsx("span",{className:"text-red-500 text-sm",children:m})]}),qe=({mode:s="create"})=>{const t=Y(),m=g.useRef(),{formData:i,fields:r,errors:p,selectedReportTime:b,customReportTime:n,isSubmitting:h,handleChange:d,handleFieldChange:x,handleReportTimeChange:j,handleSave:U,addField:P,removeField:I,addRangeType:S,removeRangeType:f,setCustomReportTime:L,getByIdLoading:D}=ye(s),F=C=>{const E=m.current;if(!E)return;const N=Array.from(E.querySelectorAll("input, select, textarea")).filter(O=>O.type!=="hidden"&&!O.disabled),w=N.indexOf(C.target);w!==-1&&(["Enter","ArrowDown","ArrowRight"].includes(C.key)&&(C.preventDefault(),w<N.length-1&&N[w+1].focus()),["ArrowUp","ArrowLeft"].includes(C.key)&&(C.preventDefault(),w>0&&N[w-1].focus()))};return D&&s==="edit"?e.jsx("div",{className:"min-h-screen bg-linear-to-br from-primary-50 via-teal-50 to-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mb-4"}),e.jsx("p",{className:"text-primary-700 text-lg",children:"Loading test data..."})]})}):e.jsx("div",{className:"min-h-screen bg-linear-to-br from-primary-50 via-teal-50 to-white p-0",children:e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden mb-8",children:[e.jsx("div",{className:"bg-primary-600 rounded-md text-white px-6 py-8 shadow-md",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-12 w-1 bg-primary-300 mr-4 rounded-full"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(oe,{className:"text-white"}),s==="create"?"New Lab Test":"Edit Lab Test"]}),e.jsx("p",{className:"text-primary-100 mt-1",children:"Please fill in the lab test details below"})]})]})}),e.jsxs("form",{onSubmit:U,ref:m,onKeyDown:F,className:"p-6",children:[e.jsx(Ne,{formData:i,errors:p,selectedReportTime:b,customReportTime:n,onChange:d,onReportTimeChange:j,onCustomReportTimeChange:L}),e.jsx(Ce,{fields:r,errors:p,onAddField:P,onRemoveField:I,onFieldChange:x,onAddRangeType:S,onRemoveRangeType:f}),e.jsx(we,{isSubmitting:h,onCancel:()=>t("../all-tests")})]})]})})})},Ne=({formData:s,errors:t,selectedReportTime:m,customReportTime:i,onChange:r,onReportTimeChange:p,onCustomReportTimeChange:b})=>e.jsx(G,{title:"Test Information",children:e.jsxs(ue,{children:[e.jsx(T,{name:"testName",label:"Test Name",value:s.testName,onChange:r,error:t.testName,required:!0}),e.jsx(T,{name:"testDept",label:"Test Department",value:s.testDept,onChange:r,error:t.testDept}),e.jsx(T,{name:"testCode",label:"Test Code",value:s.testCode,onChange:r,error:t.testCode,required:!0}),e.jsx(T,{name:"testPrice",label:"Test Price",type:"number",min:"0",value:s.testPrice,onChange:r,error:t.testPrice,required:!0}),e.jsx(fe,{selectedReportTime:m,customReportTime:i,error:t.reportDeliveryTime,onChange:p,onCustomChange:b}),e.jsx(me,{name:"requiresFasting",label:"Requires Fasting?",value:s.requiresFasting,onChange:n=>r({target:{name:"requiresFasting",value:n.target.value==="true"}}),options:[{value:!0,label:"Yes"},{value:!1,label:"No"}]})]})}),Ce=({fields:s,errors:t,onAddField:m,onRemoveField:i,onFieldChange:r,onAddRangeType:p,onRemoveRangeType:b})=>e.jsxs(G,{title:"Test Fields",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(ce,{className:"text-primary-600"})," Fields"]}),e.jsxs(B,{type:"button",onClick:m,children:[e.jsx(de,{className:"mr-1"})," Add Field"]})]}),e.jsx("div",{className:"space-y-8",children:s.map((n,h)=>e.jsx(ve,{field:n,fieldIdx:h,errors:t,onFieldChange:r,onAddRangeType:p,onRemoveRangeType:b,onRemoveField:i,rangeTypes:pe},h))})]}),we=({isSubmitting:s,onCancel:t})=>e.jsxs("div",{className:"flex justify-end gap-4 mt-8",children:[e.jsx(B,{type:"button",variant:"secondary",onClick:t,children:"Cancel"}),e.jsx(B,{type:"submit",disabled:s,children:s?"Saving...":"Save"})]});export{qe as default};
