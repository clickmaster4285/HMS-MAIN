import{r,j as e,aY as I}from"./index-D_CM1r6M.js";const U=()=>{const[o,C]=r.useState(null),[f,F]=r.useState([]),[m,b]=r.useState(new Date().toISOString().split("T")[0]),[x,v]=r.useState(new Date().toISOString().split("T")[0]),[l,R]=r.useState(""),[_,y]=r.useState(!0),[S,T]=r.useState(""),[h,E]=r.useState({totalRevenue:0,hospitalRevenue:0,doctorRevenue:0,totalRefunds:0}),P=async()=>{try{y(!0);const t=await I.get("http://localhost:5000/summary/summary");C(t.data.data),y(!1)}catch(t){T("Failed to fetch summary data"),y(!1),console.error(t)}};r.useEffect(()=>{P()},[]),r.useEffect(()=>{o&&L()},[o,m,x,l]);const L=()=>{if(!o)return;const t=new Date(m),i=new Date(x);i.setHours(23,59,59,999);let d=0,c=0,n=0,s=0;const M=o.totalDoctors.map(a=>{let j=0,w=0;const N=new Set;o.totalPatients.forEach(K=>{K.visits.forEach(u=>{const A=new Date(u.visitDate);A>=t&&A<=i&&u.doctor===a._id&&(l===""||a._id===l)&&(j+=u.amountPaid,N.add(K.patient_Name),o.totalRefunds.filter(g=>g.visit===u._id).forEach(g=>{w+=g.refundAmount,s+=g.refundAmount}))})});const p=Math.max(0,j-w),D=p*(a.doctor_Contract.hospital_Percentage/100),k=p*(a.doctor_Contract.doctor_Percentage/100);return d+=p,c+=D,n+=k,{"Doctor Name":a?.user?.user_Name,Specialization:a.doctor_Specialization,"Patient Names":Array.from(N).join(", "),"Patient Count":N.size,"Total Amount (PKR)":j.toFixed(2),"Refunds (PKR)":w.toFixed(2),"Net Amount (PKR)":p.toFixed(2),"Hospital Share (PKR)":D.toFixed(2),"Doctor Share (PKR)":k.toFixed(2),doctorId:a._id}}).filter(a=>a["Patient Count"]>0&&(l===""||a.doctorId===l));F(M),E({totalRevenue:d,hospitalRevenue:c,doctorRevenue:n,totalRefunds:s})},z=()=>{const t=new Date().toISOString().split("T")[0];b(t),v(t),R("")},H=()=>{const i=[["Doctor Name","Specialization","Patient Names","Patient Count","Total Amount (PKR)","Refunds (PKR)","Net Amount (PKR)","Hospital Share (PKR)","Doctor Share (PKR)"].join(","),...f.map(s=>[`"${s["Doctor Name"]}"`,`"${s.Specialization}"`,`"${s["Patient Names"]}"`,s["Patient Count"],s["Total Amount (PKR)"],s["Refunds (PKR)"],s["Net Amount (PKR)"],s["Hospital Share (PKR)"],s["Doctor Share (PKR)"]].join(","))].join(`
`),d=new Blob([i],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(d),n=document.createElement("a");n.setAttribute("href",c),n.setAttribute("download",`doctor-summary-${m}-to-${x}.csv`),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)};return _?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-linear-to-br from-primary-50 to-indigo-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary-500 border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 font-medium",children:"Loading financial data..."})]})}):S?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-linear-to-br from-primary-50 to-indigo-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg text-center max-w-md border border-gray-100",children:[e.jsx("div",{className:"text-red-500 text-5xl mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Error Loading Data"}),e.jsx("p",{className:"text-gray-600 mb-4",children:S}),e.jsx("button",{onClick:P,className:"bg-primary-500 hover:bg-primary-600 text-white font-medium py-2 px-4 rounded-lg transition duration-200 shadow-md hover:shadow-lg",children:"Try Again"})]})}):e.jsx("div",{className:"min-h-screen bg-linear-to-br from-primary-50 to-indigo-50 p-4 md:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8 flex flex-col md:flex-row md:items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-800",children:"Doctor Financial Summary"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Track revenue distribution between hospital and doctors"})]}),e.jsxs("button",{onClick:H,className:"mt-4 md:mt-0 flex items-center bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition duration-200 shadow-md hover:shadow-lg",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Export CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow p-5 border-l-4 border-primary-500 hover:shadow-md transition-shadow",children:[e.jsx("h3",{className:"text-gray-500 text-sm font-medium mb-1",children:"Total Revenue"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[h.totalRevenue.toFixed(2)," PKR"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-5 border-l-4 border-green-500 hover:shadow-md transition-shadow",children:[e.jsx("h3",{className:"text-gray-500 text-sm font-medium mb-1",children:"Hospital Share"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[h.hospitalRevenue.toFixed(2)," PKR"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-5 border-l-4 border-purple-500 hover:shadow-md transition-shadow",children:[e.jsx("h3",{className:"text-gray-500 text-sm font-medium mb-1",children:"Doctor Share"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[h.doctorRevenue.toFixed(2)," PKR"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-5 border-l-4 border-red-500 hover:shadow-md transition-shadow",children:[e.jsx("h3",{className:"text-gray-500 text-sm font-medium mb-1",children:"Total Refunds"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[h.totalRefunds.toFixed(2)," PKR"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-5 md:p-6 mb-8 border border-gray-100",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between mb-5",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Filters"}),e.jsxs("button",{onClick:z,className:"text-sm text-primary-500 hover:text-primary-700 flex items-center mt-2 md:mt-0 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Reset Filters"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),e.jsx("input",{type:"date",value:m,onChange:t=>b(t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 shadow-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),e.jsx("input",{type:"date",value:x,onChange:t=>v(t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 shadow-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Doctor"}),e.jsxs("select",{value:l,onChange:t=>R(t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 shadow-sm",children:[e.jsx("option",{value:"",children:"All Doctors"}),o.totalDoctors.map(t=>e.jsxs("option",{value:t._id,children:[t?.user?.user_Name||"NA"," (",t.doctor_Specialization,")"]},t._id))]})]})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100",children:f.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("svg",{className:"w-16 h-16 text-gray-300 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-700",children:"No data available"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Try adjusting your filters to see results"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Doctor"}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Specialization"}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patients"}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Amount"}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Refunds"}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Net Amount"}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Hospital Share"}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Doctor Share"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.map((t,i)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"font-medium text-gray-900",children:t["Doctor Name"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-600",children:t.Specialization}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("div",{className:"text-sm text-gray-900 font-medium",children:[t["Patient Count"]," patients"]}),e.jsx("div",{className:"text-xs text-gray-500 truncate max-w-xs",children:t["Patient Names"]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap font-semibold text-gray-800",children:[t["Total Amount (PKR)"]," PKR"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap font-medium text-red-600",children:[t["Refunds (PKR)"]," PKR"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap font-bold text-primary-800",children:[t["Net Amount (PKR)"]," PKR"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-green-600 font-medium",children:[t["Hospital Share (PKR)"]," PKR"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-purple-600 font-medium",children:[t["Doctor Share (PKR)"]," PKR"]})]},i))})]})})}),e.jsxs("div",{className:"mt-8 bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100",children:[e.jsx("div",{className:"px-6 py-4 bg-gray-50 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Refund Details"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Original Amount"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Refund Amount"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Refund Reason"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.totalRefunds.map((t,i)=>{const d=o.totalPatients.find(c=>c._id===t.patient);return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:d?d.patient_Name:"Unknown"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[t.originalAmount," PKR"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-red-600",children:[t.refundAmount," PKR"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.refundReason}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(t.refundDate).toLocaleDateString()})]},i)})})]})})]})]})})};export{U as default};
