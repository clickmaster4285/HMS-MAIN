import{f as $,u as E,r as p,I as M,j as e,d as z,l as D,m as V,J as G,K as J,M as K,y,Q,S as X}from"./index-D_CM1r6M.js";const Y=({onClose:l,onAddWard:v,onUpdateWard:W,wardDetails:b,onInputChange:n,departments:h,departmentNurses:k,isCreating:m,isProcessing:c})=>{const f=$(),{suggestedWardNumber:N,loading:S}=E(t=>t.ward),[r,L]=p.useState({department:b.department||"",department_Name:b.department_Name||"",name:b.name||"",wardNumber:b.wardNumber||"",bedCount:b.bedCount||"",nurses:b.nurses||[]});p.useEffect(()=>{m&&r.department&&!r.wardNumber&&f(M(r.department))},[m,r.department,f]),p.useEffect(()=>{m&&N&&!r.wardNumber&&u("wardNumber",N)},[N,m]),p.useEffect(()=>{if(m&&r.department&&r.wardNumber){const t=h.find(a=>a._id===r.department);if(t&&(!r.name||r.name.includes("Ward"))){const a=`${t.name} Ward ${r.wardNumber}`;u("name",a)}}},[r.department,r.wardNumber,m,h]),p.useEffect(()=>{r.department&&f(M(r.department)).unwrap().then(t=>{t.success&&t.suggestedWardNumber}).catch(t=>{console.error("Failed to get suggested ward number:",t)})},[r.department,f]);const u=(t,a)=>{const i={...r,[t]:a};if(t==="department"){const g=h.find(B=>B._id===a);i.department_Name=g?g.name:"",a&&f(M(a))}L(i),n&&(n({target:{name:t,value:a}}),t==="department"&&i.department_Name&&n({target:{name:"department_Name",value:i.department_Name}}))},_=()=>{r.department&&f(M(r.department)).unwrap().then(t=>{if(t.success&&t.suggestedWardNumber&&(u("wardNumber",t.suggestedWardNumber),m)){const a=h.find(i=>i._id===r.department);if(a){const i=`${a.name} Ward ${t.suggestedWardNumber}`;u("name",i)}}}).catch(t=>{console.error("Failed to get suggested ward number:",t)})},A=()=>{m?v():W()},C=()=>{if(r.department_Name)return r.department_Name;const t=h.find(a=>a._id===r.department);return t?t.name:""},j=()=>{if(!r.wardNumber)return"";if(typeof r.wardNumber=="string"&&r.wardNumber.includes("-")){const t=r.wardNumber.split("-");return t[t.length-1]}return r.wardNumber},o=t=>{if(typeof t=="string"&&t.includes("-")){const a=t.split("-");t=a[a.length-1]}u("wardNumber",t)};return e.jsx("div",{className:"fixed inset-0 bg-white/20 backdrop-blur-lg flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white border border-gray-400 rounded-xl p-8 shadow-lg w-[800px] max-h-[90vh] overflow-y-auto transform transition-all",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-center text-primary-800",children:m?"Add New Ward":"Edit Ward"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Department Name *"}),e.jsxs("select",{value:r.department,onChange:t=>u("department",t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 transition",disabled:c,required:!0,children:[e.jsx("option",{value:"",children:"Select Department"}),h?.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Ward Name *"}),e.jsx("input",{type:"text",value:r.name,onChange:t=>u("name",t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 transition",disabled:c,placeholder:"e.g., Cardiology Ward 1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Ward Number *"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"number",value:j(),onChange:t=>o(t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 transition",disabled:c,min:"1",required:!0,placeholder:"Enter ward number"}),r.department&&e.jsx("button",{type:"button",onClick:_,disabled:S||c,className:"whitespace-nowrap px-3 py-3 bg-primary-100 text-primary-700 rounded-lg hover:bg-primary-200 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",title:"Get next available ward number for this department",children:S?"...":"Suggest"})]}),!r.wardNumber&&e.jsx("p",{className:"mt-1 text-sm text-yellow-600",children:"Please enter a ward number or use Suggest"}),N&&e.jsxs("p",{className:"mt-1 text-sm text-green-600",children:["Suggested: ",N]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Total Bed Count *"}),e.jsx("input",{type:"number",value:r.bedCount,onChange:t=>u("bedCount",t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 transition",disabled:c,min:"1",required:!0})]})]}),C()&&r.wardNumber&&e.jsxs("div",{className:"mb-6 p-4 bg-primary-50 border border-primary-200 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-primary-800 mb-2",children:"Ward Preview"}),e.jsxs("p",{className:"text-sm text-primary-700",children:[e.jsx("strong",{children:"Ward Identifier:"})," ",C()," Ward ",j()]}),e.jsxs("p",{className:"text-sm text-primary-700",children:[e.jsx("strong",{children:"Full Ward Number:"})," ",C().substring(0,4).toUpperCase(),"-",j()]}),r.bedCount&&e.jsxs("p",{className:"text-sm text-primary-700",children:[e.jsx("strong",{children:"Beds:"})," ",r.bedCount," bed",r.bedCount!==1?"s":""," will be created as"," ",Array.from({length:Math.min(3,r.bedCount)},(t,a)=>`${C().substring(0,4).toUpperCase()}-${j()}-B${a+1}`).join(", "),r.bedCount>3?", ...":""]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"Ward-Level Nurses (Optional)"}),e.jsxs("div",{className:"space-y-3",children:[r.nurses?.map((t,a)=>e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-center",children:[e.jsxs("select",{value:t.nurse,onChange:i=>{const g=[...r.nurses];g[a].nurse=i.target.value,u("nurses",g)},className:"p-2 border border-gray-300 rounded-md shadow-sm",disabled:c,children:[e.jsx("option",{value:"",children:"Select Nurse"}),k?.map(i=>e.jsx("option",{value:i._id,children:i.user?.user_Name||`${i.firstName} ${i.lastName}`},i._id))]}),e.jsxs("select",{value:t.role,onChange:i=>{const g=[...r.nurses];g[a].role=i.target.value,u("nurses",g)},className:"p-2 border border-gray-300 rounded-md shadow-sm",disabled:c,children:[e.jsx("option",{value:"",children:"Select Role"}),e.jsx("option",{value:"Head Nurse",children:"Head Nurse"}),e.jsx("option",{value:"Staff Nurse",children:"Staff Nurse"}),e.jsx("option",{value:"Trainee",children:"Trainee"})]}),e.jsx("button",{type:"button",onClick:()=>{const i=r.nurses.filter((g,B)=>B!==a);u("nurses",i)},className:"text-red-500 hover:text-red-700 text-sm",disabled:c,children:"Remove"})]},a)),e.jsxs("button",{type:"button",onClick:()=>{const t=[...r.nurses,{nurse:"",role:""}];u("nurses",t)},className:"text-primary-500 border p-2 rounded-md hover:text-primary-700 text-sm flex items-center",disabled:c,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Ward Nurse"]})]})]}),e.jsxs("div",{className:"flex justify-between border-t pt-3 border-primary-600 mt-6",children:[e.jsxs("button",{onClick:l,className:"bg-white hover:bg-gray-400 border border-gray-400 text-gray-800 py-2 px-6 rounded-md transition flex items-center",disabled:c,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Cancel"]}),e.jsxs("button",{onClick:A,className:"bg-primary-600 hover:bg-primary-700 text-white py-2 px-6 rounded-md transition flex items-center disabled:opacity-50",disabled:c||!r.wardNumber||!r.department||!r.name||!r.bedCount,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:m?"M12 4v16m8-8H4":"M5 13l4 4L19 7"})}),c?m?"Creating...":"Updating...":m?"Add Ward":"Update Ward"]})]})]})})},Z=({ward:l,onClose:v})=>{const W=z();if(!l||!l.beds)return null;const b=n=>{W(`/receptionist/beds/${n}`)};return e.jsx("div",{className:"fixed inset-0 bg-white/20 backdrop-blur-lg flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white border border-gray-400 rounded-xl p-6 shadow-lg w-[800px] max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:["Bed Management - ",l.name," (Ward ",l.wardNumber,")"]}),e.jsx("button",{onClick:v,className:"text-gray-600 border border-gray-400 p-1 rounded-full hover:text-gray-700",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex space-x-2 underline underline-offset-2 italic mb-2",children:[e.jsx("span",{className:"font-medium",children:"Total Beds:"}),e.jsx("span",{children:l.beds.length})]}),e.jsxs("div",{className:"flex underline underline-offset-2 italic mb-2",children:[e.jsx("span",{className:"font-medium",children:"Available Beds:"}),e.jsx("span",{children:l.beds.filter(n=>!n.occupied).length})]}),e.jsxs("div",{className:"flex underline underline-offset-2 italic mb-2",children:[e.jsx("span",{className:"font-medium",children:"Occupied Beds:"}),e.jsx("span",{children:l.beds.filter(n=>n.occupied).length})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-medium text-gray-700 mb-3",children:"Bed Details"}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:l.beds.map(n=>e.jsxs("div",{className:`p-3 rounded-lg border cursor-pointer transition hover:shadow-md ${n.occupied?"bg-red-50 border-red-200":"bg-green-50 border-green-200"}`,onClick:()=>b(n._id,n.bedNumber),children:[e.jsxs("div",{className:"font-medium flex justify-between items-start",children:[e.jsxs("span",{children:["Bed #",n.bedNumber]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${n.occupied?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:n.occupied?"Occupied":"Available"})]}),n.occupied&&e.jsxs("div",{className:"text-sm mt-1 truncate",children:["Patient: ",n.currentPatientMRNo||"Unknown"]}),n.history?.length>0&&e.jsxs("div",{className:"text-xs mt-2 text-gray-500",children:[e.jsx("span",{className:"font-medium",children:n.history.length})," previous patients"]})]},n._id))})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:v,className:"bg-primary-600 hover:bg-primary-700 text-white py-2 px-6 rounded-md",children:"Close"})})]})})},ee=()=>{const l=$(),{departments:v}=E(s=>s.department),{staffList:W}=E(s=>s.staff),{allWards:b,loading:n,error:h,successMessage:k,fetchStatus:m,fetchError:c,deleteStatus:f,deleteError:N}=E(s=>s.ward),[S,r]=p.useState(!1),[L,u]=p.useState(!1),[_,A]=p.useState(null),[C,j]=p.useState(!0),[o,t]=p.useState({name:"",department:"",wardNumber:null,bedCount:null,nurses:[]}),[a,i]=p.useState([]);p.useEffect(()=>{l(D()),l(V()),l(G())},[l]),p.useEffect(()=>{if(o.department){const s=W.filter(d=>d.department===o.department&&d.staffType==="Nurse");i(s)}else i([])},[o.department,W]);const g=p.useCallback(s=>{const{name:d,value:x}=s.target;t(w=>({...w,[d]:d==="wardNumber"||d==="bedCount"?x===""?null:Number(x):x}))},[]),B=()=>{if(!o.wardNumber||!o.department){y.error("Ward Number and Department are required");return}const s=parseInt(o.wardNumber);if(isNaN(s)||s<1){y.error("Ward number must be a positive number");return}const d={name:o.name,department:o.department,wardNumber:s,bedCount:parseInt(o.bedCount)||1,nurses:o.nurses||[]};l(X(d)).unwrap().then(x=>{r(!1),I(),l(D()),y.success(x.message||"Ward created successfully!")}).catch(x=>{console.error("Failed to create ward:",x);const w=x?.message||"Failed to create ward. Please try again.";y.error(w)})},F=()=>{if(!o._id){console.error("Ward ID is missing"),y.error("Ward ID is missing");return}const s={name:o.name,department:o.department,wardNumber:o.wardNumber,bedCount:parseInt(o.bedCount)||1,nurses:o.nurses||[]};Object.keys(s).forEach(d=>{(s[d]===void 0||s[d]===null)&&delete s[d]}),l(Q({id:o._id,wardData:s})).unwrap().then(d=>{r(!1),I(),l(D()),y.success(d.message||"Ward updated successfully!")}).catch(d=>{console.error("Failed to update ward:",d);const x=d?.message||"Failed to update ward. Please try again.";y.error(x)})},O=s=>{window.confirm("Are you sure you want to delete this ward?")&&l(K(s)).unwrap().then(()=>{l(D())}).catch(d=>{console.error("Failed to delete ward:",d),alert(d?.message||"Failed to delete ward. Please try again.")})},I=()=>{t({name:"",department_Name:"",wardNumber:null,bedCount:null,nurses:[]})},T=()=>{j(!0),I(),r(!0)},U=s=>{j(!1),t({...s,nurses:s.nurses||[]}),r(!0)},q=s=>{A(s),u(!0)},H=s=>{if(!s.beds)return{totalBeds:0,availableBeds:0,occupiedBeds:0};const d=s.beds.length,x=s.beds.filter(R=>R.occupied).length,w=d-x;return{totalBeds:d,availableBeds:w,occupiedBeds:x}};return p.useEffect(()=>{if(k||h||c||N){const s=setTimeout(()=>l(J()),5e3);return()=>clearTimeout(s)}},[k,h,c,N,l]),e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex justify-between items-center text-white mb-8 bg-primary-600 p-4 rounded-lg shadow-md",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Ward Management"}),e.jsx("p",{className:"mt-1",children:"Manage hospital wards and their configurations"})]}),e.jsxs("button",{onClick:T,className:"bg-white hover:bg-gray-200 text-primary-700 font-medium py-2 px-6 rounded-lg shadow-md transition flex items-center",disabled:m==="loading"||n,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add New Ward"]})]}),k&&e.jsx("div",{className:"mb-6 p-4 bg-green-100 text-green-700 rounded-lg border border-green-200",children:k}),h&&e.jsx("div",{className:"mb-6 p-4 bg-red-100 text-red-700 rounded-lg border border-red-200",children:typeof h=="object"?h.message:h}),c&&e.jsx("div",{className:"mb-6 p-4 bg-red-100 text-red-700 rounded-lg border border-red-200",children:c}),N&&e.jsx("div",{className:"mb-6 p-4 bg-red-100 text-red-700 rounded-lg border border-red-200",children:N}),e.jsx("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ward Number"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ward Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Bed Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m==="loading"?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-6 py-4 text-center",children:"Loading wards..."})}):b&&b.length>0?b.map(s=>{const{totalBeds:d,availableBeds:x,occupiedBeds:w}=H(s);return e.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.department_Name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.wardNumber}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"mr-4",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Total:"}),e.jsx("span",{className:"ml-1 text-sm font-medium",children:d})]}),e.jsxs("div",{className:"mr-4",children:[e.jsx("span",{className:"text-xs font-medium text-primary-500",children:"Available:"}),e.jsx("span",{className:"ml-1 text-sm font-medium",children:x})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-red-500",children:"Occupied:"}),e.jsx("span",{className:"ml-1 text-sm font-medium",children:w})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2 divide-x-2 divide-gray-400",children:[e.jsx("button",{onClick:()=>q(s),className:"text-primary-600 hover:text-primary-900",children:"View"}),e.jsx("button",{onClick:()=>U(s),className:"text-yellow-600 hover:text-yellow-900",children:"Edit"}),e.jsx("button",{onClick:()=>O(s._id),className:"text-red-600 hover:text-red-900",disabled:f==="loading",children:f==="loading"?"Deleting...":"Delete"})]})})]},s._id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No wards found"})})})]})})}),S&&e.jsx(Y,{onClose:()=>r(!1),onAddWard:B,onUpdateWard:F,wardDetails:o,onInputChange:g,departments:v,departmentNurses:a,isCreating:C,isProcessing:n}),L&&_&&e.jsx(Z,{ward:_,onClose:()=>u(!1)})]})};export{ee as default};
